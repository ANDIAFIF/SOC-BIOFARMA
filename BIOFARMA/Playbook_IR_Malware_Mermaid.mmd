%%{init: {'theme': 'neutral', 'themeVariables': { 'primaryColor': '#ffffff', 'primaryTextColor': '#333', 'primaryBorderColor': '#999', 'lineColor': '#666', 'secondaryColor': '#fafafa', 'tertiaryColor': '#f5f5f5', 'background': '#ffffff'}}}%%

flowchart TB
    %% ========================================
    %% FASE PERSIAPAN
    %% ========================================
    subgraph PREPARE["PERSIAPAN"]
        direction TB

        P_START([MULAI]) --> P1["Menentukan<br/>Tim Operasional Inti &<br/>Mendefinisikan Peran"]

        P1 --> P1A["SOC Analyst L1"]
        P1 --> P1B["SOC Analyst L2"]
        P1 --> P1C["Incident Responder"]
        P1 --> P1D["Threat Hunter"]
        P1 --> P1E["IR Manager"]

        P1 --> P2["Menentukan<br/>Tim Extended &<br/>Mendefinisikan Peran"]

        P2 --> P2A["Pimpinan<br/>Eksekutif"]
        P2 --> P2B["Pimpinan<br/>IT Security"]
        P2 --> P2C["Dukungan Respons<br/>Hukum/Humas"]

        P1 --> P_SME["Subject Matter Experts"]
        P_SME --> P_SME1["Manajer<br/>Kerentanan"]
        P_SME --> P_SME2["Manajer<br/>Ancaman"]
        P_SME --> P_SME3["Manajer<br/>Risiko"]

        P2 --> P3["Menentukan<br/>Jalur Eskalasi"]

        P3 --> P3A[("Dokumen<br/>Eskalasi")]
        P3 --> P3B["Konfigurasi QRadar<br/>Notification Rules"]
        P3B --> P3C["Setup Email &<br/>SIEM Integration"]
        P3C --> P3D[("Dokumen<br/>Kontak")]

        P3 --> P_NEXT([Langkah<br/>Selanjutnya])
    end

    %% ========================================
    %% FASE DETEKSI
    %% ========================================
    subgraph DETECT["DETEKSI"]
        direction TB

        D_PREV([Langkah<br/>Sebelumnya]) --> D_THREAT["Mendefinisikan<br/>Indikator Ancaman"]

        %% Indikator Standar
        D_STD1["Alert terpicu dari<br/>QRadar Offense<br/>Rules"]
        D_STD2["Aktivitas login tidak biasa<br/>dari Windows Event<br/>Log Source"]
        D_STD3["Eksekusi proses mencurigakan<br/>terdeteksi oleh<br/>EDR/Endpoint Logs"]
        D_STD4["Lalu lintas jaringan anomali<br/>terdeteksi oleh<br/>Network Flow Analysis"]
        D_STD5["Percobaan autentikasi gagal<br/>melebihi batas<br/>threshold"]
        D_STD6["Hash file cocok dengan<br/>X-Force Threat<br/>Intelligence"]

        D_STD1 --> D_STANDARD["STANDAR"]
        D_STD2 --> D_STANDARD
        D_STD3 --> D_STANDARD
        D_STD4 --> D_STANDARD
        D_STD5 --> D_STANDARD
        D_STD6 --> D_STANDARD

        D_STANDARD --> D_THREAT

        %% Indikator Khusus
        D_THREAT --> D_CUSTOM["KHUSUS"]
        D_CUSTOM --> D_CUST1["Indikator Khusus<br/>IOC Internal<br/>Reference Set"]

        %% Faktor Risiko
        D_THREAT --> D_RISK["Mendefinisikan<br/>Faktor Risiko"]

        %% Faktor Risiko Standar
        D_RISK_STD1["Data sensitif berisiko<br/>terekspos"]
        D_RISK_STD2["Sistem kritikal<br/>terdampak"]
        D_RISK_STD3["Tindakan ini dapat<br/>dieksploitasi untuk<br/>aktivitas kriminal"]
        D_RISK_STD4["Ini dapat berdampak<br/>negatif terhadap<br/>reputasi publik"]
        D_RISK_STD5["Pelanggan terdampak<br/>oleh insiden ini"]
        D_RISK_STD6["Layanan bisnis<br/>terdampak oleh<br/>insiden ini"]
        D_RISK_STD7["Kepatuhan regulasi<br/>TERDAMPAK"]
        D_RISK_STD8["Penyebaran lateral<br/>TERDETEKSI"]

        D_RISK_STD1 --> D_RISK_STANDARD["STANDAR"]
        D_RISK_STD2 --> D_RISK_STANDARD
        D_RISK_STD3 --> D_RISK_STANDARD
        D_RISK_STD4 --> D_RISK_STANDARD
        D_RISK_STD5 --> D_RISK_STANDARD
        D_RISK_STD6 --> D_RISK_STANDARD
        D_RISK_STD7 --> D_RISK_STANDARD
        D_RISK_STD8 --> D_RISK_STANDARD

        D_RISK_STANDARD --> D_RISK

        %% Faktor Risiko Khusus
        D_RISK --> D_RISK_CUSTOM["KHUSUS"]
        D_RISK_CUSTOM --> D_RISK_CUST1["Faktor Risiko<br/>Spesifik Organisasi"]

        %% Tindakan Tambahan
        D_RISK --> D_CAPTURE["Jalankan AQL Query<br/>untuk Investigasi"]
        D_CAPTURE --> D_SCAN["Cek X-Force<br/>Threat Intelligence"]

        D_SCAN --> D_NEXT([Langkah<br/>Selanjutnya])
    end

    %% ========================================
    %% FASE ANALISIS
    %% ========================================
    subgraph ANALYZE["ANALISIS"]
        direction TB

        A_PREV([Langkah<br/>Sebelumnya]) --> A_RISK["Analisis Detail<br/>Offense QRadar"]

        %% Analisis Standar
        A_STD1["Review Offense<br/>Magnitude & Severity"]
        A_STD2["Analisis Log Activity<br/>terkait Offense"]
        A_STD3["Review Network Activity<br/>Flow Analysis"]
        A_STD4["Identifikasi Asset<br/>yang Terdampak"]
        A_STD5["Korelasi dengan<br/>Offense Lain"]
        A_STD6["Timeline Analysis<br/>Event Sequence"]
        A_STD7["User Behavior<br/>Analysis"]
        A_STD8["IOC Extraction<br/>& Validation"]

        A_STD1 --> A_STANDARD["STANDAR"]
        A_STD2 --> A_STANDARD
        A_STD3 --> A_STANDARD
        A_STD4 --> A_STANDARD
        A_STD5 --> A_STANDARD
        A_STD6 --> A_STANDARD
        A_STD7 --> A_STANDARD
        A_STD8 --> A_STANDARD

        A_STANDARD --> A_RISK

        %% Analisis Khusus
        A_RISK --> A_CUSTOM["KHUSUS"]
        A_CUSTOM --> A_CUST1["Bisnis<br/>Impact"]
        A_CUSTOM --> A_CUST2["Kepatuhan<br/>Regulasi"]
        A_CUSTOM --> A_CUST3["Operasional<br/>Impact"]
        A_CUSTOM --> A_CUST4["Reputasi<br/>Impact"]
        A_CUST1 --> A_CUST_FACTOR["Custom AQL Query<br/>untuk Investigasi"]
        A_CUST2 --> A_CUST_FACTOR
        A_CUST3 --> A_CUST_FACTOR
        A_CUST4 --> A_CUST_FACTOR

        A_RISK --> A_MALWARE{"Tipe<br/>Malware?"}
        A_MALWARE -->|Ransomware| A_MAL1["Prioritas:<br/>Proteksi Data"]
        A_MALWARE -->|Trojan/RAT| A_MAL2["Prioritas:<br/>Deteksi C2"]
        A_MALWARE -->|Worm| A_MAL3["Prioritas:<br/>Cegah Penyebaran"]
        A_MALWARE -->|Cryptominer| A_MAL4["Prioritas:<br/>Proteksi Resource"]

        A_MAL1 --> A_NEXT([Langkah<br/>Selanjutnya])
        A_MAL2 --> A_NEXT
        A_MAL3 --> A_NEXT
        A_MAL4 --> A_NEXT
    end

    %% ========================================
    %% FASE PENAHANAN
    %% ========================================
    subgraph CONTAIN["PENAHANAN"]
        direction TB

        C_PREV([Langkah<br/>Sebelumnya]) --> C_SEVERITY{"Menentukan<br/>Tingkat Keparahan"}

        C_SEVERITY -->|Kritis| C_CRITICAL["Isolasi Segera<br/>Host Terinfeksi"]
        C_SEVERITY -->|Tinggi| C_HIGH["Isolasi Jaringan<br/>VLAN Quarantine"]
        C_SEVERITY -->|Sedang| C_MEDIUM["Nonaktifkan Akun<br/>Pengguna Terdampak"]
        C_SEVERITY -->|Rendah| C_LOW["Monitor &<br/>Dokumentasi"]

        C_CRITICAL --> C_ACTION1["Update QRadar<br/>Reference Set:<br/>Blocked_IPs"]
        C_HIGH --> C_ACTION2["Update QRadar<br/>Reference Set:<br/>Blocked_Domains"]
        C_MEDIUM --> C_ACTION3["Update QRadar<br/>Reference Set:<br/>Blocked_Users"]
        C_LOW --> C_ACTION4["Buat Custom Rule<br/>untuk Monitoring"]

        C_ACTION1 --> C_PRESERVE["Preserve Evidence:<br/>Memory Dump &<br/>Log Collection"]
        C_ACTION2 --> C_PRESERVE
        C_ACTION3 --> C_PRESERVE
        C_ACTION4 --> C_PRESERVE

        C_PRESERVE --> C_SPREAD{"Penyebaran<br/>Terdeteksi?"}
        C_SPREAD -->|Ya| C_EXPAND["Perluas Scope<br/>Containment"]
        C_SPREAD -->|Tidak| C_HUNT["Threat Hunting<br/>via QRadar AQL"]

        C_EXPAND --> C_HUNT

        C_HUNT --> C_ESCALATE{"Eskalasi ke<br/>Tim IR?"}
        C_ESCALATE -->|Ya| C_IR["Aktifkan Tim IR<br/>& Tim Extended"]
        C_ESCALATE -->|Tidak| C_NEXT([Langkah<br/>Selanjutnya])
        C_IR --> C_NEXT
    end

    %% ========================================
    %% FASE PEMBERANTASAN
    %% ========================================
    subgraph ERADICATE["PEMBERANTASAN"]
        direction TB

        E_PREV([Langkah<br/>Sebelumnya]) --> E_ROOT["Identifikasi Akar Masalah<br/>via QRadar Investigation"]

        E_ROOT --> E_ACTION1["Hapus File<br/>Malware"]
        E_ROOT --> E_ACTION2["Bersihkan Registry<br/>& Persistence"]
        E_ROOT --> E_ACTION3["Terminate<br/>Malicious Process"]
        E_ROOT --> E_ACTION4["Hapus Scheduled<br/>Tasks Berbahaya"]
        E_ROOT --> E_ACTION5["Remove Malicious<br/>Services"]

        E_ACTION1 --> E_SCAN["Jalankan Full<br/>AV/EDR Scan"]
        E_ACTION2 --> E_SCAN
        E_ACTION3 --> E_SCAN
        E_ACTION4 --> E_SCAN
        E_ACTION5 --> E_SCAN

        E_SCAN --> E_VERIFY{"Sistem<br/>Bersih?"}
        E_VERIFY -->|Tidak| E_REIMAGE["Reimage<br/>Sistem"]
        E_VERIFY -->|Ya| E_VALIDATE["Validasi via<br/>QRadar Monitoring"]

        E_REIMAGE --> E_VALIDATE
        E_VALIDATE --> E_CHECK{"Verifikasi<br/>Berhasil?"}
        E_CHECK -->|Tidak| E_ROOT
        E_CHECK -->|Ya| E_NEXT([Langkah<br/>Selanjutnya])
    end

    %% ========================================
    %% FASE PEMULIHAN
    %% ========================================
    subgraph RECOVER["PEMULIHAN"]
        direction TB

        R_PREV([Langkah<br/>Sebelumnya]) --> R_PLAN["Rencanakan<br/>Pemulihan Sistem"]

        R_PLAN --> R_RESTORE["Pulihkan Sistem<br/>dari Clean Backup"]
        R_RESTORE --> R_PATCH["Terapkan<br/>Security Patches"]
        R_PATCH --> R_CRED["Reset Semua<br/>Kredensial Terdampak"]
        R_CRED --> R_VERIFY["Verifikasi Integritas<br/>Sistem"]

        R_VERIFY --> R_ENABLE["Integrasi Bertahap<br/>ke Jaringan"]
        R_ENABLE --> R_MONITOR["Enhanced Monitoring<br/>via QRadar<br/>24-72 Jam"]

        R_MONITOR --> R_RULE["Buat Custom Rule<br/>untuk Deteksi<br/>Reinfeksi"]

        R_RULE --> R_CHECK{"Sistem<br/>Sehat?"}
        R_CHECK -->|Tidak| R_PLAN
        R_CHECK -->|Ya| R_NEXT([Langkah<br/>Selanjutnya])
    end

    %% ========================================
    %% FASE PASCA-INSIDEN
    %% ========================================
    subgraph POST_INCIDENT["PASCA-INSIDEN"]
        direction TB

        PI_PREV([Langkah<br/>Sebelumnya]) --> PI_CLOSE["Update Status Offense<br/>ke Closed di QRadar"]

        PI_CLOSE --> PI_DOC["Dokumentasi Lengkap:<br/>Timeline & Actions"]
        PI_DOC --> PI_IOC["Dokumentasi IOC<br/>yang Ditemukan"]
        PI_IOC --> PI_REPORT["Buat Laporan Insiden<br/>via QRadar Reports"]

        PI_REPORT --> PI_LESSON["Lakukan Pertemuan<br/>Lessons Learned"]
        PI_LESSON --> PI_UPDATE["Update Playbook &<br/>Detection Rules"]
        PI_UPDATE --> PI_REFSET["Update Reference Sets<br/>dengan IOC Baru"]
        PI_REFSET --> PI_DASHBOARD["Update QRadar<br/>Dashboard & Reports"]

        PI_DASHBOARD --> PI_TRAIN["Conduct Training &<br/>Awareness Session"]
        PI_TRAIN --> PI_SHARE["Bagikan Threat Intel<br/>ke Tim Terkait"]

        PI_SHARE --> PI_END([SELESAI])
    end

    %% ========================================
    %% KONEKSI ANTAR FASE
    %% ========================================
    P_NEXT --> D_PREV
    D_NEXT --> A_PREV
    A_NEXT --> C_PREV
    C_NEXT --> E_PREV
    E_NEXT --> R_PREV
    R_NEXT --> PI_PREV

    %% ========================================
    %% STYLING - Warna Transparan/Netral
    %% ========================================
    classDef preparePhase fill:transparent,stroke:#666,color:#333
    classDef detectPhase fill:transparent,stroke:#666,color:#333
    classDef analyzePhase fill:transparent,stroke:#666,color:#333
    classDef containPhase fill:transparent,stroke:#666,color:#333
    classDef eradicatePhase fill:transparent,stroke:#666,color:#333
    classDef recoverPhase fill:transparent,stroke:#666,color:#333
    classDef postPhase fill:transparent,stroke:#666,color:#333
    classDef standardBox fill:#f9f9f9,stroke:#aaa,color:#333
    classDef customBox fill:#f0f0f0,stroke:#999,color:#333
    classDef decisionBox fill:#fff,stroke:#888,color:#333
    classDef terminator fill:#f5f5f5,stroke:#999,color:#333

    class PREPARE preparePhase
    class DETECT detectPhase
    class ANALYZE analyzePhase
    class CONTAIN containPhase
    class ERADICATE eradicatePhase
    class RECOVER recoverPhase
    class POST_INCIDENT postPhase
    class D_STANDARD,D_RISK_STANDARD,A_STANDARD standardBox
    class D_CUSTOM,D_RISK_CUSTOM,A_CUSTOM customBox
    class C_SEVERITY,C_SPREAD,C_ESCALATE,E_VERIFY,E_CHECK,R_CHECK,A_MALWARE decisionBox
    class P_START,P_NEXT,D_PREV,D_NEXT,A_PREV,A_NEXT,C_PREV,C_NEXT,E_PREV,E_NEXT,R_PREV,R_NEXT,PI_PREV,PI_END terminator
